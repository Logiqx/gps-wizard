## GPS Exchange Format (GPX) - GPSResults

### Summary

GPSResults would benefit from some simple enhancements to the GPX loader for GPX 1.1 compliant files:

- Support for "speed" and "course"  in GPX 1.1 compliant files and files generated by Waterspeed.

The GPX files produced by GPSResults have a few issues which would be worth fixing for GPX 1.0 compliance:

- Lack of GPX 1.0 compliance can lead to compatibility issues:
  - Absence of schema location.
  - Element names do not always match the GPX 1.0 schema; "cog" instead of "course".
  - Element sequencing does not match the GPX 1.0 schema which is "ele", "time", "course", "speed", "sat", hdop".
  - Elements called "sdop" and "vsdop" are currently exported but are not supported by GPX 1.0.
  - The "metadata" element is used but that is part of GPX 1.1 and not available in GPX 1.0.
- It is probably worth generating GPX 1.1 files and using the extensions in the TrackpointExtras schema, instead of using GPX 1.0:
  - The elements "speed" and "course" (n.b. not "cog") are supported by TrackpointExtras v1
  - TrackpointExtras v1 also supports "sdop" and "vsdop", albeit called "sacc" and "vsacc".
  - The "metadata" component can also be included, although you will need to use extensions for element unique to GPSResults.

These issues are described in the next section, followed by a section listing recommendations.



### Import Issues

#### Speed and Course

GPSResults can load GPX 1.0 files without any problems:

- Supports the "speed" and "course" elements of GPX 1.0.

GPSResults would benefit from enhancements to support "course" and "speed" in GPX 1.1 compliant files:

- Add support for the proprietary "gpxdata:speed" introduced by the Kickstarter [Trace](https://www.kickstarter.com/projects/activereplay/trace-the-most-advanced-activity-monitor-for-actio) and used by [Waterspeed](https://waterspeedapp.com/).
- Add support for GPX 1.1 + TrackpointExtension v2 including "course" and "speed". See speed [article](../speed.md) for details.
- Add support for GPX 1.1 + TrackpointExtras v1 including "course", "speed" and accuracy estimates. See [article](../../xmlschemas/tpx/1/0/README.md) for details.



### Export Issues

#### GPX Compliance

GPSResults has a tiny header and uses its own XML namespace which is not correct.

```xml
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<gpx xmlns="https://www.gps-speed.com"
     creator="GPSResults V6.185">
```

GPSResults should really use a standard GPX 1.0 header:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<gpx creator="GPSResults V6.185 - https://www.gps-speed.com"
     version="1.0"
     xmlns="http://www.topografix.com/GPX/1/0"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd">
```



#### Element Names and Order

The current order of the elements does not conform to the GPX 1.0 schema:

```xml
<trkpt lat="50.154425200" lon="-5.027364900">
    <ele>-0.60</ele>
    <time>2022-09-29T10:44:55.000Z</time>
    <sat>18</sat>
    <speed>2.295</speed>
    <cog>249.859</cog>
</trkpt>
```

The correct order for elements is shown below, also with "cog" renamed to "course" to conform with the GPX 1.0 schema:
```xml
<trkpt lat="50.154425200" lon="-5.027364900">
    <ele>-0.60</ele>
    <time>2022-09-29T10:44:55.000Z</time>
    <course>249.859</course>
    <speed>2.295</speed>
    <sat>18</sat>
</trkpt>
```

n.b. HDOP is currently absent in exports from GPSResults. The `<hdop>` element should appear immediately after `<sat>`.



#### Metadata

The metadata element does not exist in the GPX 1.0 schema:

```xml
<metadata>
  <link href="http://www.gps-speed.com">
    <text>GPS-Results</text>
  </link>
  <time>2008-11-15T14:34:07Z</time>
  <username>unknown</username>
  <device>Forerunner205</device>
  <firmware>2.80</firmware>
  <serialno>3384310285</serialno>
</metadata>
```

n.b. It should also be noted that "username", "device", "firmware "and "serialno" are not part of GPX 1.1.

A suitable schema extension could be created and hosted on gps-speed.com.



#### SDOP and VSDOP

GPSResults writes SDOP and VSDOP to exported GPX files:

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <speed>1.480</speed>
  <cog>199.090</cog>
  <hdop>1.40</hdop>
  <sdop>0.25</sdop>
  <vsdop>0.29</vsdop>
  <fix>43</fix>
</trkpt>
```

The elements "sdop" and "vsdop" have two issues:

1) They are not supported by GPX 1.0 so the file should really be GPX 1.1 and use an `<extensions>` element.
2) They are exported (+imported) in knots, rather than m/s. This is inconsistent with the "speed" (m/s) and also results in rounding errors.

The TrackpointExtras v1 extension supports course, speed, SDOP and VSDOP as follows:

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <tpx:extras>
      <tpx:course>199.090</tpx:course>
      <tpx:speed>1.480<tpx:speed>
      <tpx:sacc>0.5</tpx:sacc>
      <tpx:vsacc>0.7</tpx:vsacc>
    </tpx:extras>
  </extensions>
</trkpt>
```



#### GPX 1.1

If GPX 1.1 is chosen then the header will need to be updated and should declare the [TrackPointExtras](../../xmlschemas/tpx/1/0/README.md) extension:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<gpx creator="GPS Wizard"
     version="1.1"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:tpx="http://logiqx.github.io/gps-wizard/xmlschemas/tpx/1/0"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1
                         http://www.topografix.com/GPX/1/1/gpx.xsd
                         http://logiqx.github.io/gps-wizard/xmlschemas/tpx/1/0
                         http://logiqx.github.io/gps-wizard/xmlschemas/tpx10.xsd">
```

The [TrackPointExtras](../../xmlschemas/tpx/1/0/README.md) schema already supports speed accuracy (akin to SDOP) and vertical speed accuracy (asking to VSDOP) estimates:

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <tpx:extras>
      <tpx:course>199.090</tpx:course>
      <tpx:speed>1.480<tpx:speed>
      <tpx:sacc>0.5</tpx:sacc>
      <tpx:vsacc>0.7</tpx:vsacc>
    </tpx:extras>
  </extensions>
</trkpt>
```



### Recommendations

#### GPX Import

- Enhance GPX loader to support `<gpxdata:speed>` which was introduced by the Kickstarter [Trace](https://www.kickstarter.com/projects/activereplay/trace-the-most-advanced-activity-monitor-for-actio) and is used by [Waterspeed](https://waterspeedapp.com/).

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <gpxdata:speed>1.480</gpxdata:speed>
  </extensions>
</trkpt>
```
- Enhance GPX loader to support GPX 1.1 + TrackpointExtension v2 for `<xxx:course>` and `<xxx:speed>`. See [document](../speed.md) for further details.

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <gpxtpx:TrackPointExtension>
      <gpxtpx:speed>1.480</gpxtpx:speed>
      <gpxtpx:course>199.090</gpxtpx:course>
    </gpxtpx:TrackPointExtension>
  </extensions>
</trkpt>
```
- Enhance GPX loader to support GPX 1.1 + TrackpointExtras v1 for `<xxx:course>`, `<xxx:speed>` and the accuracy metrics. See [document](../../xmlschemas/tpx/1/0/README.md) for further details.

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <tpx:extras>
      <tpx:course>199.090</tpx:course>
      <tpx:speed>1.480<tpx:speed>
      <tpx:sacc>0.5</tpx:sacc>
      <tpx:vsacc>0.7</tpx:vsacc>
    </tpx:extras>
  </extensions>
</trkpt>
```
- Fix time issues - 1 hour offset vs OAO files.



#### GPX Export

- Enhance the GPX export to use a standard GPX 1.0 header to facilitate validation using [SAXCount](https://www.topografix.com/gpx_validation.asp).
  - If the "metadata" element is desired it will necessitate GPX 1.1 and a schema extension with a suitable namespace.
  - However, GPX 1.1 has implications relating to the "[doppler speed](../speed.md)" so it is probably advisable to stick with GPX 1.0.
- Change GPX export to use `<course>` instead of `<cog>` thus matching the element name in the GPX schema.
- Enhance GPX export to use the element order mandated by the GPX schema - "ele", "time", "course", "speed", "sat", hdop".
- Export "sdop" and "vsdop" using the original m/s and change the loader accordingly. This will avoid rounding issues.
- Switch to GPX 1.1 (instead of using GPX 1.0) so that SDOP ("sacc") + VSDOP ("vsacc") and metadata can be included in a GPX-compliant manner.

```xml
<trkpt lat="53.371207100" lon="-3.190282800">
  <ele>-2.74</ele>
  <time>2022-02-06T11:22:06.600Z</time>
  <sat>5</sat>
  <hdop>1.40</hdop>
  <extensions>
    <tpx:extras>
      <tpx:course>199.090</tpx:course>
      <tpx:speed>1.480<tpx:speed>
      <tpx:sacc>0.5</tpx:sacc>
      <tpx:vsacc>0.7</tpx:vsacc>
    </tpx:extras>
  </extensions>
</trkpt>
```
