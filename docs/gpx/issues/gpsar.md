## GPS Exchange Format (GPX) - GpsarPro

### Summary

GpsarPro would benefit from some simple enhancements to the GPX loader for GPX 1.0 and GPX 1.1 compliant files.

- Support for "course" in GPX 1.0 compliant files and "cog" (produced by GPSResults and COROS).
- Support for "speed" and "course"  in GPX 1.1 compliant files.
- Support for "hr" (heartrate) even when the schema alias is not "gpxtpx".

The GPX files produced by GpsarPro have a few issues which would be worth fixing for (almost) GPX 1.0 compliance:

- Lack of GPX 1.0 compliance due to the proprietary "gpsarPro" schema.
- Element order does not match the GPX 1.0 schema which is "ele", "time", "course", "speed", "sat", hdop".
- Invalid elements such as "color".
- Use of the "gpsarPro" namespace in a GPX 1.0 file.

These issues are described in the next section, followed by a section listing recommendations.



### Import Issues

#### Speed and Course

GPX 1.0:

- GpsarPro supports the "speed" element of GPX 1.0 but it does not support support "course" (GPX 1.0) or "cog" (produced by GPSResults and COROS).

GPX 1.1:

- Supports the non-standard "gpxdata:speed" introduced by the Kickstarter [Trace](https://www.kickstarter.com/projects/activereplay/trace-the-most-advanced-activity-monitor-for-actio) and used by [Waterspeed](https://waterspeedapp.com/).
- Does not support TrackpointExtension v2 extensions for "course" and "speed". See [document](../speed.md) for details.
- Does not support TrackpointExtras v1 extensions for "course", "speed" and error estimates. See [document](../../xmlschemas/tpx/1/0/README.md) for details.



#### Heartrate

GpsarPro supports "hr" from the Garmin TrackPointExtension, available in [v1](https://www8.garmin.com/xmlschemas/TrackPointExtensionv1.xsd) and [v2](https://www8.garmin.com/xmlschemas/TrackPointExtensionv2.xsd).

However, this support only works when the prefix "gpxtpx" is used which is something of a deficiency. The namespace prefix can be pretty much anything chosen by the producer of the GPX file.

n.b. Heartrate is included in GPX files generated by [Waterspeed](https://waterspeedapp.com/) which uses the "gpxtpx" prefix.



### Export Issues

#### GPX 1.0

The header is ok, except there is no schema location for the "gpsarPro" namespace.

```xml
<gpx creator="GpsarPro 5.3"
     version="1.0"
     xmlns="http://www.topografix.com/GPX/1/0"
     xmlns:gpsarPro="http://www.gpsactionreplay.com/xml"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/0
                         http://www.topografix.com/GPX/1/0/gpx.xsd">
```



#### Element Order

The order of the elements does not conform to the GPX schema:

```xml
<trkpt lat="52.0488357" lon="-0.56904">
  <ele>100.36</ele>
  <time>2022-08-02T10:35:28Z</time>
  <speed>0.16</speed>
  <hdop>3.8</hdop>
  <sat>5</sat>
</trkpt>
```

The correct order is shown below:

```xml
<trkpt lat="52.0488357" lon="-0.56904">
  <ele>100.36</ele>
  <time>2022-08-02T10:35:28Z</time>
  <speed>0.16</speed>
  <sat>5</sat>
  <hdop>3.8</hdop>
</trkpt>
```

Course is also absent and could be exported. The `<course>` element should appear between `<time>` and `<speed>`.



#### Invalid Elements

GPX exports from GpsarPro include a "color" element:

```xml
<color>-65536</color>
```

This is not part of the GPX schema so it should be added to a dedicated schema and namespace.



#### Extensions

GPX files generated by gpsarPro make use of elements belonging to a dedicated schema:

```xml
<gpsarPro:satsInView>70254721</gpsarPro:satsInView>
<gpsarPro:nGPS>1</gpsarPro:nGPS>
<gpsarPro:maxNoDataDuration>60000</gpsarPro:maxNoDataDuration>
<gpsarPro:annotations></gpsarPro:annotations>
```

However, without a suitable XSD available online and specified in xsi:schemaLocation it is impossible to validate the GPX.

The only way to extend the GPX schema is to use GPX 1.1 which leads to additional complexities, especially relating to [speed](../speed.md).



### Recommendations

#### GPX Import

- Enhance GPX loader to recognize `<course>` (GPX 1.0) and `<cog>` (produced by GPSResults and COROS).
- Enhance GPX loader to support GPX 1.1 + TrackpointExtension v1 + v2 for `<xxx:hr>`, regardless of prefix and not just for "gpxtpx".
- Enhance GPX loader to support GPX 1.1 + TrackpointExtension v2 for `<xxx:course>` and `<xxx:speed>`. See [document](../speed.md) for details.
- Enhance GPX loader to support GPX 1.1 + TrackpointExtras v1 for `<xxx:course>` and `<xxx:speed>`. See [document](../../xmlschemas/tpx/1/0/README.md) for details.



#### GPX Export

Simple improvements to the GPX export:

- Enhance GPX export to include `<course>` which is part of GPX 1.0.
- Enhance GPX export to use the element order mandated by the GPX 1.0 schema - "ele", "time", "course", "speed", "sat", hdop".

In addition to the above, further improvements can be made with regards the custom extensions:

- Upload a suitable GpsarPro XSD to http://www.gpsactionreplay.com/ and include it in xsi:schemaLocation.
- Add "color" to the GpsarPro schema and rename the "color" elements to "gpsarPro:color" in the GPX export.

However, using extensions like this will still cause the GPX 1.0 validation to fail, so these elements would need stripping from the GPX prior to validation.

The only way to avoid this issue is to use GPX 1.1 but that will lead to additional complexities and backward compatibility issues, especially for [speed](../speed.md).
