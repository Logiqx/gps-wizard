## GPS Exchange Format (GPX) - COROS

### Summary

The GPX 1.0 files produced by COROS have a number of issues:

- Lack of GPX 1.0 compliance which can be summarized as follows:
  - Mixture of GPX 1.0 and GPX 1.1. The files have a GPX 1.0 header but GPX 1.1 content.
  - Inclusion of GPX 1.1 elements (e.g. metadata and track type) and extensions (e.g. heartrate) in a GPX 1.0 file.
- Incorrect element names; "cog" instead of "course", "heartrate" instead of "hr".
- Missing data elements; "ele" (elevation) and "speed".

These issues are described in the next section, followed by a section listing recommendations.



### Issues

#### GPX 1.0

GPX files generated by COROS suggest use of the GPX 1.0 schema:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<gpx creator="Coros Wearables"
     xmlns="http://www.topografix.com/GPX/1/0"
     xmlns:gpxdata="http://www.cluetrust.com/XML/GPXDATA/1/0"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/0 http://www.topografix.com/GPX/1/0/gpx.xsd
                         http://www.cluetrust.com/XML/GPXDATA/1/0 http://www.cluetrust.com/Schemas/gpxdata10.xsd">
```

Issues with the header:

- The "version" attribute is missing which should be `version="1.0"`.
- The ClueTrust GPXData is for GPX 1.1, making xmlns:gpxdata and the associated schema location invalid.



#### Incorrect Element Names

The following elements are incorrectly named in COROS files:

- `<cog>` elements instead of `<course>`.
- `<heartrate>` elements instead of `<hr>.`

Notes:

- Course over ground is called "course" in [GPX 1.0](https://www.topografix.com/GPX/1/0/gpx.xsd) and [GPX 1.1](https://www.topografix.com/GPX/1/1/gpx.xsd).
- Heartrate is called "hr" in ClueTrust [GPXData](http://www.cluetrust.com/Schemas/gpxdata10.xsd) and Garmin [TrackPointExtension](http://www.garmin.com/xmlschemas/TrackPointExtensionv2.xsd).



#### Missing Elements

The following elements could be added to trackpoints:

- Elevation (m) - `<ele>`
- Speed (m/s) - `<speed>`

Elevation is available in GPX 1.0 and GPX 1.1, whereas speed is only available in GPX 1.0.



#### GPX 1.1 Elements

COROS files include "metadata" which is not supported by GPX 1.0:

```xml
  <metadata>
    <time>2022-04-04T12:41:30Z</time>
  </metadata>
```

The track also include a "type" element which is not supported by GPX 1.0:

```xml
  <trk>
    <name>Lidlington Speedsurfing</name>
    <type>Other</type>
    <trkseg>
     ...
```

Both "metadata" and "type" need to be removed if the file is to GPX 1.0 compliant.



#### GPX 1.1 Extensions

The following extensions are used within COROS files:


```xml
<extensions>
  <heartrate>100</heartrate>
  <distance>7</distance>
</extensions>
```

To be GPX compliant they must use the appropriate prefix and the correct element name:

```xml
<extensions>
  <gpxdata:hr>100</gpxdata:hr>
  <gpxdata:distance>7</gpxdata:distance>
</extensions>
```

However, GPX 1.0 does not support extensions so this is not sufficient for GPX 1.0 compliance.

There are only two options:

1) Ensure GPX 1.0 compliance by removing "extensions" elements ("hr" and "distance") and removing "GPXDATA" references from the GPX header.

2) Ensure GPX 1.1 compliance, including appropriate "course" and "speed" elements as described in the dedicated [document](../speed.md).

FWIW, I believe it would be best for COROS to generate GPX 1.1 compliant files. I will contact all of the software developers in the speedsurfing community to ensure they fully support the "course" and "speed" elements of GPX 1.1 compliant files.



### Recommendations

#### GPX 1.0

The simplest option is to use GPX 1.0 for windsurfing and speedsurfing activities. GPX 1.0 is widely supported the GPS-Speedsurfing world.

To ensure the exported file is [GPX 1.0](https://www.topografix.com/GPX/1/0/gpx.xsd) compliant:

- Add `version="1.0"` to the `<gpx>` element.
- Remove the "GPXDATA" references from the header; xmlns:gpxdata and the location of gpxdata10.xsd.
- Rename the `<cog>`elements  to `<course>.`
- Ensure the element order mandated by the GPX 1.0 schema - “ele”, “time”, “course”, “speed”, “sat”, hdop”.
- Remove the `<metadata>` element.
- Remove the `<type>` element from the `<trk>` element.
- Remove the `<extensions>` from the `<trkpt>` elements (i.e. remove heartrate and distance).

Add missing elements to the GPX 1.0 files:

- Add `<ele>` to the `<trkpt>` elements.
- Add `<speed>` to the `<trkpt>` elements.

GPX 1.0 files can be validated using the method(s) described in the [overview](../README.md) document.



#### GPX 1.1

If COROS wish to use GPX 1.1 (probably the best approach) then extensions will be required for course and [speed](../speed.md) to be recorded. 

To ensure the exported file is [GPX 1.1](https://www.topografix.com/GPX/1/1/gpx.xsd) compliant:

- Add `version="1.1"` to the `<gpx>` element.
- Switch from ClueTrust GPXData to Garmin TrackPointExtension v2:

```xml
<gpx version="1.1" creator="Garmin Connect"
  xmlns="http://www.topografix.com/GPX/1/1"
  xmlns:gpxtpx="http://www.garmin.com/xmlschemas/TrackPointExtension/v2"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd 
      http://www.garmin.com/xmlschemas/TrackPointExtension/v2 http://www.garmin.com/xmlschemas/TrackPointExtensionv2.xsd"
```

- Adhere to the `<trkpt>` element order mandated by GPX 1.1 - “ele”, “time”, “sat”, hdop”.
- Rename `<heartrate>` to `<gpxtpx:hr>`.
- Drop`<distance>` since it is basically redundant and doesn't warrant use of the ClueTrust GPXData schema.

To add missing elements to the GPX 1.1 files:

- Add `<ele>` to the `<trkpt>` elements.
- Add `<gpxtpx:speed>` and `<gpxtpx:course>` using TrackPointExtension V2:

```xml
<trkpt lat="50.5710623" lon="-2.4563484">
  <ele>7.90</ele>
  <time>2022-04-11T10:16:01Z</time>
  <sat>6</sat>
  <hdop>1.4</hdop>
  <extensions>
    <gpxtpx:TrackPointExtension>
      <gpxtpx:hr>60</gpxtpx:hr>
      <gpxtpx:speed>0.5429</gpxtpx:speed>
      <gpxtpx:course>157.19</gpxtpx:course>
    </gpxtpx:TrackPointExtension>
  </extensions>
</trkpt>
```

Note how `<cog>` was renamed  to `<gpxtpx:course>` and moved into the extensions, along with `<gpxtpx:speed>`.

GPX 1.1 files can be validated using the method(s) described in the [overview](../README.md) document.

